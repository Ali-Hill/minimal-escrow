<body ><h1 >Files</h1><ul ><li ><a href="#src/Contract/Escrow.hs" >src/Contract/Escrow.hs</a></li></ul><hr><h2 id="src/Contract/Escrow.hs" >src/Contract/Escrow.hs</h2><pre >.
.
.
   194    <span style=background-color:lightgray;color:gray >--   spending transaction to be paid to target addresses. This may happen if</span>
   195    <span style=background-color:lightgray;color:gray >--   the target address is also used as a change address for the spending</span>
   196    <span style=background-color:lightgray;color:gray >--   transaction, and allowing the target to be exceed prevents outsiders from</span>
   197    <span style=background-color:lightgray;color:gray >--   poisoning the contract by adding arbitrary outputs to the script address.</span>
   198    <span style=background-color:lightgray;color:gray >meetsTarget :: TxInfo -&gt; EscrowTarget DatumHash -&gt; Bool</span>
   199    <span style=background-color:white;color:black >meetsTarget ptx = \case</span><span style=background-color:lightgray;color:gray ></span>
   200    <span style=background-color:white;color:black >    PaymentPubKeyTarget pkh vl -&gt;</span><span style=background-color:lightgray;color:gray ></span>
   201    <span style=background-color:white;color:black >        </span><span style=background-color:white;color:black >valuePaidTo </span><span style=background-color:white;color:black >ptx </span><span style=background-color:white;color:black >(unPaymentPubKeyHash pkh) </span><span style=background-color:lightgreen;color:black >`geq` </span><span style=background-color:white;color:black >vl</span><span style=background-color:white;color:black ></span><span style=background-color:lightgray;color:gray ></span>
   202    <span style=background-color:white;color:black >    ScriptTarget validatorHash dataValue vl -&gt;</span><span style=background-color:lightgray;color:gray ></span>
   203    <span style=background-color:white;color:black >        </span><span style=background-color:black;color:orangered >case scriptOutputsAt </span><span style=background-color:black;color:orangered >validatorHash </span><span style=background-color:black;color:orangered >ptx </span><span style=background-color:black;color:orangered >of</span><span style=background-color:lightgray;color:gray ></span>
   204    <span style=background-color:black;color:orangered >            [(dataValue&#39;, vl&#39;)] -&gt;</span><span style=background-color:lightgray;color:gray ></span>
   205    <span style=background-color:black;color:orangered >                </span><span style=background-color:black;color:orangered >traceIfFalse </span><span style=background-color:black;color:orangered >&quot;dataValue&quot; </span><span style=background-color:black;color:orangered >(dataValue&#39; == </span><span style=background-color:black;color:orangered >(OutputDatumHash </span><span style=background-color:black;color:orangered >dataValue)</span><span style=background-color:black;color:orangered >)</span><span style=background-color:black;color:orangered ></span><span style=background-color:lightgray;color:gray ></span>
   206    <span style=background-color:black;color:orangered >                &amp;&amp; </span><span style=background-color:black;color:orangered >traceIfFalse </span><span style=background-color:black;color:orangered >&quot;value&quot; </span><span style=background-color:black;color:orangered >(</span><span style=background-color:black;color:orangered >vl&#39; </span><span style=background-color:black;color:orangered >`geq` </span><span style=background-color:black;color:orangered >vl)</span><span style=background-color:black;color:orangered ></span><span style=background-color:black;color:orangered ></span><span style=background-color:lightgray;color:gray ></span>
   207    <span style=background-color:black;color:orangered >            _ -&gt; </span><span style=background-color:black;color:orangered >False</span><span style=background-color:lightgray;color:gray ></span>
   208    <span style=background-color:lightgray;color:gray ></span>
   209    <span style=background-color:lightgray;color:gray >{-# INLINABLE validate #-}</span>
   210    <span style=background-color:lightgray;color:gray >validate :: EscrowParams DatumHash -&gt; PaymentPubKeyHash -&gt; Action -&gt; ScriptContext -&gt; Bool</span>
   211    <span style=background-color:white;color:black >validate EscrowParams{escrowDeadline, escrowTargets} contributor action ScriptContext{scriptContextTxInfo} =</span><span style=background-color:lightgray;color:gray ></span>
   212    <span style=background-color:white;color:black >    </span><span style=background-color:white;color:black >case action of</span><span style=background-color:lightgray;color:gray ></span>
   213    <span style=background-color:white;color:black >        Redeem -&gt;</span><span style=background-color:lightgray;color:gray ></span>
   214    <span style=background-color:white;color:black >            </span><span style=background-color:white;color:black >traceIfFalse </span><span style=background-color:white;color:orangered >&quot;escrowDeadline-after&quot; </span><span style=background-color:white;color:black >(</span><span style=background-color:white;color:black >escrowDeadline </span><span style=background-color:white;color:black >`after` txInfoValidRange scriptContextTxInfo)</span><span style=background-color:lightgray;color:gray ></span>
   215    <span style=background-color:white;color:black >            &amp;&amp; </span><span style=background-color:white;color:lightgreen >traceIfFalse </span><span style=background-color:white;color:orangered >&quot;meetsTarget&quot; </span><span style=background-color:white;color:lightgreen >(all </span><span style=background-color:white;color:black >(meetsTarget </span><span style=background-color:white;color:black >scriptContextTxInfo)</span><span style=background-color:white;color:black > </span><span style=background-color:white;color:black >escrowTargets)</span><span style=background-color:white;color:lightgreen ></span><span style=background-color:white;color:black ></span><span style=background-color:lightgray;color:gray ></span>
   216    <span style=background-color:white;color:black >        Refund -&gt;</span><span style=background-color:lightgray;color:gray ></span>
   217    <span style=background-color:white;color:black >            </span><span style=background-color:white;color:lightgreen >traceIfFalse </span><span style=background-color:white;color:orangered >&quot;escrowDeadline-before&quot; </span><span style=background-color:white;color:lightgreen >(</span><span style=background-color:white;color:black >(</span><span style=background-color:white;color:black >escrowDeadline </span><span style=background-color:white;color:black >- </span><span style=background-color:white;color:black >1)</span><span style=background-color:white;color:black > </span><span style=background-color:white;color:lightgreen >`before` </span><span style=background-color:white;color:black >txInfoValidRange scriptContextTxInfo)</span><span style=background-color:white;color:lightgreen ></span><span style=background-color:lightgray;color:gray ></span>
   218    <span style=background-color:white;color:lightgreen >            &amp;&amp; </span><span style=background-color:white;color:lightgreen >traceIfFalse </span><span style=background-color:white;color:orangered >&quot;txSignedBy&quot; </span><span style=background-color:white;color:lightgreen >(</span><span style=background-color:white;color:black >scriptContextTxInfo </span><span style=background-color:white;color:lightgreen >`txSignedBy` </span><span style=background-color:white;color:black >unPaymentPubKeyHash contributor)</span><span style=background-color:white;color:lightgreen ></span><span style=background-color:lightgray;color:gray ></span>
   219    <span style=background-color:lightgray;color:gray ></span>
   220    <span style=background-color:lightgray;color:gray >typedValidator :: EscrowParams Datum -&gt; V2.TypedValidator Escrow</span>
   221    <span style=background-color:lightgray;color:gray >typedValidator escrow = go (Haskell.fmap datumHash escrow) where</span>
   222    <span style=background-color:lightgray;color:gray >    go = V2.mkTypedValidatorParam @Escrow</span>
   223    <span style=background-color:lightgray;color:gray >        $$(PlutusTx.compile [|| validate ||])</span>
.
.
.
   382    <span style=background-color:lightgray;color:gray ></span>
   383    <span style=background-color:lightgray;color:gray >covIdx :: CoverageIndex</span>
   384    <span style=background-color:lightgray;color:gray >covIdx = getCovIdx $$(PlutusTx.compile [|| validate ||])</span>
   385    <span style=background-color:lightgray;color:gray ></span>
   386    <span style=background-color:lightgray;color:gray >covIdx&#39; :: CoverageIndex</span>
   387    <span style=background-color:lightgray;color:gray >covIdx&#39; = computeRefinedCoverageIndex $$(</span><span style=background-color:lightpink;color:black >PlutusTx.compile [|| \a b c d -&gt; check (validate a b c d) ||])</span><span style=background-color:lightgray;color:gray ></span>
</pre></body>